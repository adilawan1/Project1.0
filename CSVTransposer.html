<div class="custom-widget">
  <p>
    <label>
      Enter CSV
      <br />
      <textarea cols="40" rows="10" id="input" class="inputfull"></textarea>
    </label>
  </p>

  <p>
    <input
      id="input-convert"
      type="submit"
      onclick="CSV2TC()"
      value="Transpose"
    />
  </p>

  <p>
    <label
      >Transposed CSV<br />
      <textarea cols="40" rows="10" id="output" class="inputfull" readonly="">
      </textarea>
    </label>
  </p>
  <script>
    // Helper function to convert CSV to TEXT Columns
    function CSV2TC() {
      const csvStr = document.getElementById("input").value;
      const regex = /("[^",]+),([^",]+")/g; // Matches commas between inverted commas
      const updatedCsv = csvStr.replace(regex, "$1\t$2"); // Replaces commas with exclamation marks
      let txtString = `${Csvtotc(updatedCsv)}`;
      function Csvtotc(obj) {
        let arr = obj.split("\n");
        let col = arr[0].split(",");
        arr.shift();
        let row = arr.length;
        let text = "";
        for (let j = 0; j < col.length; j++) {
          text += col[j] + ",";
          for (let i = 0; i < row; i++) {
            if (arr[i].split(",")[j] !== undefined) {
              if (i < row - 1) text += arr[i].split(",")[j] + ",";
              else text += arr[i].split(",")[j];
            }
          }
          if (col.length - 1 === j) text += "";
          else text += "\n";
        }
        return text;
      }
      txtString = txtString.replaceAll("\t", ",");
      document.getElementById("output").innerHTML = txtString;
    }
  </script>
</div>
