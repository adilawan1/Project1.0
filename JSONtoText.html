<div>
  <h1>JSON to Plain Text Converter</h1>

  <h2>File Upload</h2>
  <button id="file-convert">Upload Data</button>
  <br /><br />

  <h2>Input</h2>
  <textarea id="input"></textarea>
  <button id="input-convert" onclick="jSontoText()">Convert</button>
  <br /><br />

  <h2>URL</h2>
  <input type="url" id="url-input" />
  <button id="url-convert">Upload</button>
  <br /><br />

  <h2>Output</h2>
  <textarea id="output"></textarea>
  <button type="submit" id="download-btn">Download Txt</button>
  <script>
    const downloadButton = document.getElementById("download-btn");
    const fileInput = document.getElementById("file-input");
    const fileConvertButton = document.getElementById("file-convert");
    fileConvertButton.addEventListener("click", () => {
      var input = document.createElement("input");
      input.type = "file";
      input.onchange = (e) => {
        // getting a hold of the file reference
        var file = e.target.files[0];

        // setting up the reader
        var reader = new FileReader();
        reader.readAsText(file, "UTF-8"); // this is reading as data url

        // here we tell the reader what to do when it's done reading...
        reader.onload = (readerEvent) => {
          var content = readerEvent.target.result; // this is the content!
          console.log(content);
          document.querySelector("#input").innerText = content;
        };
      };
      input.click();
    });

    const input = document.getElementById("input");
    const inputConvertButton = document.getElementById("input-convert");
    const urlInput = document.getElementById("url-input");
    const urlConvertButton = document.getElementById("url-convert");
    urlConvertButton.addEventListener("click", () => {
      fetch(document.getElementById("url-input").value)
        .then((res) => res.text())
        .then((text) => (document.getElementById("input").innerHTML = text));
    });

    function jSontoText() {
      var JSONText = document.getElementById("input").value;
      const jsonObj = JSON.parse(JSONText);

      // Convert JSON to XML
      const parser = new DOMParser();
      const TextString = `${jsonToText(jsonObj)}`;
      //const text = TextString;
      // Helper function to convert JSON to XML
      function jsonToText(json) {
        let textstr = "";
        for (let key in json) {
          if (Array.isArray(json[key])) {
            textstr += key;
            json[key].forEach(function (item) {
              textstr += "\n" + jsonToText(item);
            });
          } else if (typeof json[key] === "object") {
            textstr += "\n" + key + "\t";
            textstr += jsonToText(json[key]);
          } else {
            if (
              Object.keys(json[key]).length === 1 &&
              JSON.stringify(json) !== JSON.stringify(json[key])
            )
              textstr += json[key];
            else textstr += "\n" + key + "\t" + json[key];
          }
        }
        return textstr;
      }
      // Convert XML to string
      document.getElementById("output").innerHTML = TextString;
    }

    downloadButton.addEventListener("click", () => {
      if (document.getElementById("output").value != null) {
        let filename = "output.txt";

        var link = document.createElement("a");

        link.setAttribute(
          "href",
          "data:csv/plain;charset=utf-8," +
            encodeURIComponent(document.getElementById("output").value)
        );

        link.setAttribute("download", filename);

        link.click();
      }
    });
  </script>
</div>
